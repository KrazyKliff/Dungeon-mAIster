stages:
  - test

default:
  image: node:18

cache:
  key:
    files:
      - package-lock.json
  paths:
    - node_modules/

run_tests:
  stage: test
  script:
    - echo "Installing dependencies..."
    - npm ci --legacy-peer-deps
    - echo "Building all projects..."
    - npx nx run-many -t build
    - echo "Starting backend server in the background..."
    - npx nx serve backend &
    - echo "Waiting for server to start..."
    - sleep 10
    - echo "Running linting and testing..."
    - npx nx run-many -t lint test
